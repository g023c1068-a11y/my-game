<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Leaderboard Game</title>
    <style>
        /* CSSでゲームエリアとリーダーボードのレイアウトを整える */
        body { text-align: center; font-family: sans-serif; }
        #game-area { display: inline-block; margin-right: 20px; }
        #leaderboard-area { display: inline-block; vertical-align: top; width: 300px; padding: 10px; border: 1px solid #ccc; }
        #score-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        #score-table th, #score-table td { border: 1px solid #ddd; padding: 8px; }
    </style>
</head>
<body>

    <div id="game-area">
        <div id="unity-container" class="unity-desktop">
            <canvas id="unity-canvas" width=960 height=600></canvas>
        </div>
        </div>

    <div id="leaderboard-area">
        <h2>🏆 リーダーボード</h2>
        <table id="score-table">
            <thead>
                <tr><th>Rank</th><th>Name</th><th>Score</th></tr>
            </thead>
            <tbody id="leaderboard-body">
                <tr><td>-</td><td>Loading...</td><td>-</td></tr>
            </tbody>
        </table>
    </div>

    <script src="Build/MyGame.loader.js"></script> 

    <script>
        // ビルドファイルや設定を定義 (Unityのテンプレートによってマクロ置換される)
        var buildUrl = "Build";
        var loaderUrl = buildUrl + "/MyGame.loader.js";
        var config = {
            dataUrl: buildUrl + "/MyGame.data.unityweb",
            frameworkUrl: buildUrl + "/MyGame.framework.js.unityweb",
            codeUrl: buildUrl + "/MyGame.wasm.unityweb",
            // その他の設定...
        };

        var unityContainer = document.querySelector("#unity-container");
        var canvas = document.querySelector("#unity-canvas");
        var loadingBar = document.querySelector("#unity-loading-bar"); // Optional

        // ゲームをインスタンス化
        createUnityInstance(canvas, config, (progress) => {
            // ローディング進捗の処理 (省略)
        }).then((unityInstance) => {
            // 成功: インスタンスをグローバル変数に保存しておくと、後でUnity関数を呼び出すのに便利
            window.unityGameInstance = unityInstance;
            
            // ページロード時にランキングを取得・表示する関数を呼び出す
            fetchLeaderboard(); 

        }).catch((message) => {
            console.error("Unity failed to load:", message);
        });

        // ----------------------------------------------------
        // ★ リーダーボード関連のカスタム関数
        // ----------------------------------------------------

        // 外部サーバーからランキングデータを取得し、HTMLに表示する関数
        function fetchLeaderboard() {
            // ★実際には、ここでサーバーAPIを呼び出す (例: fetch('YOUR_API_ENDPOINT/scores'))
            
            // === [デモデータ] ===
            const scores = [
                { rank: 1, name: "Alice", score: 12500 },
                { rank: 2, name: "Bob", score: 9800 },
                { rank: 3, name: "Char", score: 7500 }
            ];
            // ==================

            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = ''; // 一旦クリア

            scores.forEach(s => {
                const row = tbody.insertRow();
                row.insertCell().textContent = s.rank;
                row.insertCell().textContent = s.name;
                row.insertCell().textContent = s.score.toLocaleString();
            });
        }

        // Unity (C#) から呼び出されるJavaScript関数
        // Unity側では [DllImport("__Internal")] public static extern void SubmitScore(string name, int score); と連携
        window.SubmitScoreToWeb = function(name, score) {
            console.log("Score received from Unity:", name, score);
            // ★実際には、ここでスコアをサーバーAPIにPOSTする (例: fetch('YOUR_API_ENDPOINT/submit', { method: 'POST', body: JSON.stringify(...) }))
            
            // スコア送信後、ランキングを再取得
            fetchLeaderboard();
        }

    </script>
</body>
</html>